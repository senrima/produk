<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Pembayaran - S-Tools ID</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F9FAFB; /* Light Gray */
            color: #1F2937;
        }
        /* Styles for printing */
        @media print {
            body {
                background-color: #FFFFFF;
            }
            .no-print {
                display: none;
            }
            .invoice-container {
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>

    <!-- Tombol Aksi (Hanya tampil di layar, tidak saat print) -->
    <div class="no-print container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="javascript:history.back()" class="text-gray-600 hover:text-indigo-600 font-semibold">
            &larr; Kembali
        </a>
        <button onclick="window.print()" class="bg-indigo-600 text-white font-semibold px-5 py-2.5 rounded-lg hover:bg-indigo-700 transition-colors">
            Cetak / Simpan PDF
        </button>
    </div>

    <!-- Kontainer Invoice -->
    <div class="container mx-auto p-6 md:p-10 my-6">

        <!-- Loading Skeleton -->
        <div id="loading-container" class="max-w-4xl mx-auto animate-pulse">
            <div class="bg-white p-8 md:p-12 rounded-2xl border border-gray-200 shadow-lg">
                <div class="flex justify-between items-start mb-10">
                    <div>
                        <div class="h-10 w-32 bg-gray-200 rounded mb-2"></div>
                        <div class="h-4 w-48 bg-gray-200 rounded"></div>
                    </div>
                    <div class="text-right">
                        <div class="h-8 w-40 bg-gray-300 rounded mb-2"></div>
                        <div class="h-4 w-32 bg-gray-200 rounded"></div>
                    </div>
                </div>
                <div class="h-4 bg-gray-200 rounded w-1/4 mb-10"></div>
                <div class="h-10 bg-gray-100 rounded-lg mb-4"></div>
                <div class="h-10 bg-gray-100 rounded-lg"></div>
            </div>
        </div>

        <!-- Pesan Error (disembunyikan secara default) -->
        <div id="error-container" class="hidden max-w-4xl mx-auto text-center bg-red-100 text-red-700 p-8 rounded-2xl border border-red-200">
            <h2 class="text-2xl font-bold mb-2">Invoice Tidak Ditemukan</h2>
            <p id="error-message">Maaf, kami tidak dapat menemukan detail untuk nomor invoice ini. Pastikan link yang Anda gunakan sudah benar.</p>
        </div>

        <!-- Konten Invoice (disembunyikan sampai data berhasil dimuat) -->
        <div id="invoice-content" class="hidden invoice-container bg-white p-8 md:p-12 rounded-2xl border border-gray-200 shadow-lg max-w-4xl mx-auto">
            
            <header class="flex justify-between items-start mb-10">
                <div>
                    <img src="stools_logo.png" alt="S-Tools ID Logo" class="h-10 w-auto mb-2">
                    <h1 class="text-2xl font-bold text-gray-900">S-Tools ID</h1>
                    <p class="text-gray-500">Raihan Sweet Home B13, Maros, Indonesia</p>
                </div>
                <div class="text-right">
                    <h2 class="text-3xl font-bold text-gray-800">INVOICE</h2>
                    <p id="invoice-number" class="text-gray-500 mt-1"></p>
                </div>
            </header>

            <section class="grid grid-cols-2 gap-8 mb-10">
                <div>
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Ditagihkan Kepada</h3>
                    <p id="customer-name" class="font-bold text-gray-800"></p>
                    <p id="customer-email" class="text-gray-600"></p>
                </div>
                <div class="text-right">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Detail Transaksi</h3>
                    <p id="invoice-date" class="text-gray-800"></p>
                    <p id="invoice-status-container" class="text-gray-800"></p>
                </div>
            </section>

            <section>
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="p-4 font-semibold text-gray-700 rounded-l-lg">Deskripsi</th>
                            <th class="p-4 font-semibold text-gray-700 text-right rounded-r-lg">Jumlah</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-100">
                            <td class="p-4">
                                <p id="product-name-inv" class="font-semibold text-gray-800"></p>
                                <p id="product-id-inv" class="text-sm text-gray-500"></p>
                            </td>
                            <td id="product-price-inv" class="p-4 text-right font-medium text-gray-800"></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="mt-8 flex justify-end">
                <div class="w-full max-w-sm space-y-4">
                    <div class="flex justify-between text-gray-600">
                        <span>Subtotal</span>
                        <span id="subtotal-inv"></span>
                    </div>
                    <div id="discount-row" class="hidden justify-between text-gray-600">
                        <span>Diskon <span id="coupon-code-span" class="font-semibold"></span></span>
                        <span id="discount-inv"></span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Biaya Layanan</span>
                        <span id="fee-inv"></span>
                    </div>
                    <div class="border-t border-gray-200 my-2"></div>
                    <div class="flex justify-between font-bold text-gray-900 text-xl">
                        <span>Total Dibayar</span>
                        <span id="total-inv"></span>
                    </div>
                </div>
            </section>

            <section class="mt-10 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Ketentuan Pembelian</h3>
                <ul class="space-y-3 text-gray-600 text-sm list-disc list-inside">
                    <li>
                        <strong>Memiliki Akun:</strong> Pastikan Anda sudah memilki akun di S-tools ID sesuai dengan email yang anda gunakan untuk membeli, jika belum memilki akun bisa kelik <a href="https://s-tools.id/app/daftar.html" target="_blank" class="text-indigo-600 hover:underline">daftar</a> dan pastikan menggunakan email pembelian produk.
                    </li>
                    <li>
                        <strong>Akses Produk:</strong> Pembelian ini memberikan Anda akses ke produk. Anda dapat mengaksesnya kapan saja melalui dashboard akun Anda sesuai dengan <a href="syarat-ketentuan.html" target="_blank" class="text-indigo-600 hover:underline">syarat dan ketentuan</a> yang berlaku.
                    </li>
                    <li>
                        <strong>Bonus:</strong> Semua bonus yang tertera pada halaman penjualan telah disertakan dan dapat diakses bersamaan dengan produk utama.
                    </li>
                    <li>
                        <strong>Koin S-Tools:</strong> Metode pembayaran Transfer Bank yang menggunakan angka unik Anda akan menerima <strong class="text-green-600">1 Koin</strong> yang akan ditambahkan ke akun Anda setelah pembayaran ini diverifikasi. Koin dapat digunakan untuk mendapatkan diskon pada pembelian berikutnya.
                    </li>
                    <li>
                        <strong>Dukungan:</strong> Anda berhak mendapatkan dukungan teknis terkait produk ini selama 30 hari melalui email <a href="mailto:me@mail.s-tools.id" class="text-indigo-600 hover:underline">me@mail.s-tools.id</a>.
                    </li>
                    <li>
                        <strong>Lisensi:</strong> Produk ini dilisensikan untuk penggunaan pribadi atau bisnis internal Anda dan tidak untuk dijual kembali.
                    </li>
                    <li>
                        <strong>Pembelian Afiliasi:</strong> Jika Anda melakukan pembelian melalui link afiliasi, bonus atau penawaran khusus lainnya akan diatur dan dikirimkan langsung oleh partner afiliasi masing-masing.
                    </li>
                </ul>
            </section>

            <footer class="mt-12 pt-8 border-t border-gray-200 text-center">
                <p class="text-gray-600">Terima kasih atas pembelian Anda!</p>
                <p class="text-sm text-gray-500 mt-1">Jika ada pertanyaan, silakan hubungi kami di <a href="mailto:me@mail.s-tools.id" class="text-indigo-600 hover:underline">me@mail.s-tools.id</a></p>
            </footer>

        </div>
    </div>

    <script>
        const API_URL = 'https://api.senrima.web.id'; // Ganti dengan URL Web App Anda

        const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);

        function showError(message) {
            document.getElementById('loading-container').classList.add('hidden');
            const errorContainer = document.getElementById('error-container');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
        }

        function displayInvoiceDetails(data) {
            document.getElementById('loading-container').classList.add('hidden');
            document.getElementById('invoice-content').classList.remove('hidden');

            document.getElementById('invoice-number').textContent = `#${data.NomorInvoice}`;
            document.getElementById('customer-name').textContent = data.NamaPembeli;
            document.getElementById('customer-email').textContent = data.EmailPembeli;
            
            const date = new Date(data.TanggalTerbit);
            document.getElementById('invoice-date').innerHTML = `<span class="font-semibold">Tanggal Terbit:</span> ${date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}`;
            
            let statusBadge = '';
            if (data.Status === 'SUCCESS') {
                statusBadge = '<span class="bg-green-100 text-green-700 font-bold py-1 px-3 rounded-full text-sm">LUNAS</span>';
            } else {
                statusBadge = '<span class="bg-yellow-100 text-yellow-700 font-bold py-1 px-3 rounded-full text-sm">PENDING</span>';
            }
            document.getElementById('invoice-status-container').innerHTML = `<span class="font-semibold">Status:</span> ${statusBadge}`;

            document.getElementById('product-name-inv').textContent = data.NamaProduk;
            document.getElementById('product-id-inv').textContent = `ID Produk: ${data.IDProduk}`;
            document.getElementById('product-price-inv').textContent = formatCurrency(data.HargaProduk);

            document.getElementById('subtotal-inv').textContent = formatCurrency(data.HargaProduk);
            
            // Logika untuk menampilkan diskon dan kode kupon
            if (data.Diskon && data.Diskon > 0) {
                const discountRow = document.getElementById('discount-row');
                const couponCodeSpan = document.getElementById('coupon-code-span');
                const discountInv = document.getElementById('discount-inv');
                
                if (data.KodeKupon) {
                    couponCodeSpan.textContent = `(${data.KodeKupon})`;
                }
                discountInv.textContent = `- ${formatCurrency(data.Diskon)}`;
                discountRow.classList.remove('hidden');
                discountRow.classList.add('flex');
            }

            document.getElementById('fee-inv').textContent = formatCurrency(data.BiayaLayanan);
            document.getElementById('total-inv').textContent = formatCurrency(data.TotalPembayaran);
        }

        async function fetchInvoiceDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const invoiceId = urlParams.get('invoice');

            if (!invoiceId) {
                showError("Nomor invoice tidak ditemukan di URL. Pastikan link yang Anda gunakan sudah benar.");
                return;
            }

            const payload = {
                kontrol: 'proteksi',
                action: 'getinvoicedetails',
                invoiceId: invoiceId
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (response.ok && result.status === 'sukses') {
                    displayInvoiceDetails(result.data);
                } else {
                    throw new Error(result.message || 'Gagal mengambil data invoice.');
                }
            } catch (error) {
                console.error("Gagal mengambil detail invoice:", error);
                showError(error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchInvoiceDetails);
    </script>
</body>
</html>


